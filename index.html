<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamCalc ‚Äî –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π</title>
    
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="application-name" content="DreamCalc">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DreamCalc">
    <meta name="description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#2563eb">

    <!-- –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º -->
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="mask-icon" href="icons/safari-pinned-tab.svg" color="#2563eb">
    <link rel="shortcut icon" href="favicon.ico">

    <!-- –ú–∞–Ω–∏—Ñ–µ—Å—Ç PWA -->
    <link rel="manifest" href="manifest.json">

    <!-- Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- –°—Ç–∏–ª–∏ –º–æ–¥—É–ª–µ–π -->
    <link rel="stylesheet" href="modules/header/header.css">
    <link rel="stylesheet" href="modules/footer/footer.css">
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <link rel="stylesheet" href="styles/main.css">
    
    <!-- –®—Ä–∏—Ñ—Ç Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ö–µ–¥–µ—Ä–∞ -->
    <div id="header-container">
        <!-- –ó–∞–≥–ª—É—à–∫–∞ –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <nav class="navbar navbar-light bg-light" id="header-placeholder">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <span class="me-2">üéØ</span>
                    <strong>DreamCalc</strong>
                    <small class="text-muted ms-2">v2.1.0</small>
                </a>
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
            </div>
        </nav>
    </div>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="container py-4" id="app">
        <!-- –°—Ç–∞—Ä—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∫—Ä—ã–≤–∞–µ–º, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å —Ö–µ–¥–µ—Ä -->
        <header class="text-center mb-4 d-none" id="old-header">
            <h1 class="display-5 fw-bold text-primary">
                üéØ DreamCalc ‚Äî –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π
            </h1>
            <p class="lead text-muted">
                –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ —Å–≤–æ–µ–π —Ü–µ–ª–∏ —Å —É—á—ë—Ç–æ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π
            </p>
        </header>

        <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —á–µ—Ä–µ–∑ JS -->
        <main id="main-content">
            <!-- –ó–∞–≥–ª—É—à–∫–∞ –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...</span>
                </div>
                <p class="mt-3 text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ DreamCalc v2.1.0...</p>
            </div>
        </main>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ—É—Ç–µ—Ä–∞ -->
        <div id="footer-container">
            <!-- –ó–∞–≥–ª—É—à–∫–∞ –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <footer class="mt-5 pt-4 border-top text-center text-muted" id="footer-placeholder">
                <p>DreamCalc v2.1.0 ‚Ä¢ –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç–∏</p>
                <p class="small text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ñ—É—Ç–µ—Ä–∞...</p>
            </footer>
        </div>
    </div>

    <!-- Bootstrap JS + Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- –ú–æ–¥—É–ª–∏ (–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–º–∏) -->
    <script type="module" src="modules/header/header.js"></script>
    <script type="module" src="modules/footer/footer.js"></script>
    
    <!-- –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ –º–æ–¥—É–ª–µ–π) -->
    <script type="module" src="scripts/app.js"></script>

    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π -->
    <script>
    (function() {
        'use strict';
        
        console.log('üöÄ DreamCalc v2.1.0 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...');
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
        const ModuleConfig = {
            header: true,
            footer: true,
            debug: true
        };
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ HTML –º–æ–¥—É–ª–µ–π
        function loadModuleHTML(moduleName) {
            if (!ModuleConfig[moduleName]) {
                console.log(`‚ö†Ô∏è –ú–æ–¥—É–ª—å ${moduleName} –æ—Ç–∫–ª—é—á–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏`);
                return Promise.resolve(false);
            }
            
            const containerId = `${moduleName}-container`;
            const container = document.getElementById(containerId);
            
            if (!container) {
                console.warn(`‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ${containerId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                return Promise.resolve(false);
            }
            
            return fetch(`modules/${moduleName}/${moduleName}.html`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(html => {
                    container.innerHTML = html;
                    console.log(`‚úÖ –ú–æ–¥—É–ª—å ${moduleName} –∑–∞–≥—Ä—É–∂–µ–Ω`);
                    return true;
                })
                .catch(error => {
                    console.warn(`‚ö†Ô∏è –ú–æ–¥—É–ª—å ${moduleName} –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω:`, error.message);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                    if (container.id === 'header-container') {
                        container.innerHTML = `
                            <nav class="navbar navbar-light bg-light mb-3">
                                <div class="container">
                                    <a class="navbar-brand" href="#">
                                        <span class="me-2">üéØ</span>
                                        <strong>DreamCalc</strong>
                                        <small class="text-muted ms-2">v2.1.0</small>
                                    </a>
                                    <span class="badge bg-warning">–•–µ–¥–µ—Ä –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</span>
                                </div>
                            </nav>
                        `;
                    }
                    
                    return false;
                });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π
        function initModules() {
            // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –µ—Å–ª–∏ —Ö–µ–¥–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω
            if (ModuleConfig.header) {
                const oldHeader = document.getElementById('old-header');
                if (oldHeader) {
                    oldHeader.classList.add('d-none');
                }
            }
            
            // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ HeaderModule
            if (ModuleConfig.header) {
                const waitForHeader = setInterval(() => {
                    if (window.HeaderModule) {
                        clearInterval(waitForHeader);
                        console.log('üéØ HeaderModule –≥–æ—Ç–æ–≤');
                        
                        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Ç–µ–º—É –∏–∑ localStorage
                        const savedTheme = localStorage.getItem('dreamcalc-theme');
                        if (savedTheme && window.HeaderModule.syncTheme) {
                            window.HeaderModule.syncTheme();
                        }
                    }
                }, 100);
                
                // –¢–∞–π–º–∞—É—Ç 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => clearInterval(waitForHeader), 5000);
            }
            
            // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ FooterModule
            if (ModuleConfig.footer) {
                const waitForFooter = setInterval(() => {
                    if (window.FooterModule) {
                        clearInterval(waitForFooter);
                        console.log('üìä FooterModule –≥–æ—Ç–æ–≤');
                    }
                }, 100);
                
                setTimeout(() => clearInterval(waitForFooter), 5000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥—É–ª–∏ –µ—Å–ª–∏ –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
            if (window.FooterModule && window.FooterModule.showNotification) {
                window.FooterModule.showNotification(message, type);
                return;
            }
            
            if (window.HeaderModule && window.HeaderModule.showNotification) {
                window.HeaderModule.showNotification(message, type);
                return;
            }
            
            // –†–µ–∑–µ—Ä–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const alertClass = {
                success: 'alert-success',
                error: 'alert-danger',
                info: 'alert-info',
                warning: 'alert-warning'
            }[type] || 'alert-info';
            
            const alertHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed top-0 end-0 m-3" 
                     style="z-index: 1060; max-width: 300px;">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', alertHTML);
            
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) alert.remove();
            }, 3000);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π...');
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ö–µ–¥–µ—Ä –ø–µ—Ä–≤—ã–º
                const headerLoaded = await loadModuleHTML('header');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ—É—Ç–µ—Ä
                const footerLoaded = await loadModuleHTML('footer');
                
                console.log('üéâ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                console.log(`- –•–µ–¥–µ—Ä: ${headerLoaded ? '‚úÖ' : '‚ùå'}`);
                console.log(`- –§—É—Ç–µ—Ä: ${footerLoaded ? '‚úÖ' : '‚ùå'}`);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
                setTimeout(initModules, 500);
                
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π:', error);
            }
        });
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('‚úÖ ServiceWorker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                        
                        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('üîÑ –ù–∞–π–¥–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ServiceWorker');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('üîÑ –î–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è');
                                    showNotification('üîÑ –î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'info');
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker:', error);
                    });
            });
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(event) {
            console.error('üö® –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
            
            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π
            if (event.error && event.error.message && event.error.message.includes('modules/')) {
                return;
            }
            
            showNotification('‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        window.addEventListener('offline', function() {
            console.log('üì¥ –ü–µ—Ä–µ—à–ª–∏ –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º');
            showNotification('üì¥ –†–∞–±–æ—Ç–∞–µ–º –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ', 'warning');
        });
        
        window.addEventListener('online', function() {
            console.log('üåê –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            showNotification('üåê –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
        });
        
        console.log('‚úÖ DreamCalc v2.1.0 –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
        
    })();
    </script>

</body>
</html>